<div class="carousel" id="{{ include.id | default: 'carousel' }}">
    <button class="nav prev" aria-label="Previous">&#10094;</button>
    <div class="track">
        {% assign imgs = site.static_files
        | where_exp:'f','f.path contains include.folder'
        | where_exp:'f','f.extname == ".png" or f.extname == ".jpg" or f.extname == ".jpeg" or f.extname == ".gif"'
        | sort: 'name' %}
        {% for f in imgs %}
        {% assign alt = f.name | split:'.' | first | replace:'-',' ' | replace:'_',' ' %}
        <div class="slide"><img src="{{ f.path | relative_url | uri_escape }}" alt="{{ alt }}"></div>
        {% endfor %}
    </div>
    <button class="nav next" aria-label="Next">&#10095;</button>
    <div class="dots">
        {% for f in imgs %}<button class="dot" aria-label="Go to slide {{ forloop.index }}"></button>{% endfor %}
    </div>
</div>

<style>
    .carousel{position:relative;max-width:980px;margin:0 auto;overflow:hidden}
    .track{display:flex;transition:transform .4s ease}
    .slide{flex:0 0 100%;display:grid;place-items:center;background:#000}
    .slide img{max-width:100%;max-height:70vh;object-fit:contain}
    .nav{position:absolute;top:50%;transform:translateY(-50%);border:0;background:rgba(0,0,0,.35);color:#fff;font-size:28px;width:42px;height:42px;border-radius:999px;cursor:pointer}
    .prev{left:8px}.next{right:8px}
    .dots{display:flex;gap:8px;justify-content:center;margin:10px 0}
    .dot{width:10px;height:10px;border:0;border-radius:50%;background:#bbb;cursor:pointer}
    .dot.active{background:#555}
    @media (hover:hover){.nav:hover{background:rgba(0,0,0,.55)}}
</style>

<script>
    (() => {
        const root=document.getElementById('{{ include.id | default: "carousel" }}');
        const track=root.querySelector('.track');
        const slides=[...root.querySelectorAll('.slide')];
        const prev=root.querySelector('.prev');
        const next=root.querySelector('.next');
        const dots=[...root.querySelectorAll('.dot')];
        let i=0,n=slides.length,w=()=>root.clientWidth;

        const go=idx=>{
            i=(idx+n)%n;
            track.style.transform=`translateX(${-i*w()}px)`;
            dots.forEach((d,j)=>d.classList.toggle('active',j===i));
        };

        const onResize=()=>go(i);
        window.addEventListener('resize',onResize);

        prev.addEventListener('click',()=>go(i-1));
        next.addEventListener('click',()=>go(i+1));
        dots.forEach((d,j)=>d.addEventListener('click',()=>go(j)));

        let t=setInterval(()=>go(i+1),5000);
        root.addEventListener('mouseenter',()=>clearInterval(t));
        root.addEventListener('mouseleave',()=>t=setInterval(()=>go(i+1),5000));

        go(0);
    })();
</script>
