{% comment %}
AToW Builder Carousel - Clean Version
{% endcomment %}

{% assign imgs = site.static_files
  | where_exp:'f','f.path contains include.folder'
  | where_exp:'f','f.extname == ".png" or f.extname == ".jpg" or f.extname == ".jpeg" or f.extname == ".gif" or f.extname == ".webp"' 
  | sort: 'name' %}

{% if imgs.size > 0 %}
<div class="carousel" id="{{ include.id | default: 'carousel' }}">
  <button class="nav prev" aria-label="Previous">&#10094;</button>
  <div class="track">
    {% for f in imgs %}
      {% assign alt = f.name | split:'.' | first | replace:'-',' ' | replace:'_',' ' %}
      <div class="slide"><img src="{{ f.path | relative_url }}" alt="{{ alt }}" loading="lazy"></div>
    {% endfor %}
  </div>
  <button class="nav next" aria-label="Next">&#10095;</button>
  <div class="dots">
    {% for f in imgs %}<button class="dot" aria-label="Go to slide {{ forloop.index }}"></button>{% endfor %}
  </div>
</div>

<style>
.carousel {
    position: relative;
    max-width: 980px;
    margin: 0 auto;
    overflow: hidden;
    border: 1px solid #ddd;
    border-radius: 8px;
}

.track {
    display: flex;
    transition: transform .4s ease;
}

.slide {
    flex: 0 0 100%;
    display: grid;
    place-items: center;
    background: #000;
}

.slide img {
    max-width: 100%;
    max-height: 70vh;
    object-fit: contain;
}

.nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    border: 0;
    background: rgba(0, 0, 0, .6);
    color: #fff;
    font-size: 28px;
    width: 42px;
    height: 42px;
    border-radius: 999px;
    cursor: pointer;
    z-index: 10;
    transition: background-color 0.3s ease;
}

.prev {
    left: 8px;
}

.next {
    right: 8px;
}

.dots {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin: 15px 0;
}

.dot {
    width: 12px;
    height: 12px;
    border: 0;
    border-radius: 50%;
    background: #bbb;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.dot.active {
    background: #555;
}

@media (hover:hover) {
    .nav:hover {
        background: rgba(0, 0, 0, .8);
    }
    
    .dot:hover {
        background: #777;
    }
}

@media (max-width: 768px) {
    .nav {
        width: 36px;
        height: 36px;
        font-size: 20px;
    }
    
    .prev {
        left: 4px;
    }
    
    .next {
        right: 4px;
    }
}
</style>

<script>
(() => {
    const root = document.getElementById('{{ include.id | default: "carousel" }}');
    
    if (!root) return;
    
    const track = root.querySelector('.track');
    const slides = [...root.querySelectorAll('.slide')];
    const prev = root.querySelector('.prev');
    const next = root.querySelector('.next');
    const dots = [...root.querySelectorAll('.dot')];
    
    if (!track || slides.length === 0) return;
    
    let currentIndex = 0;
    let totalSlides = slides.length;
    let autoSlideTimer = null;
    
    const getCarouselWidth = () => root.clientWidth;
    
    const goToSlide = (targetIndex) => {
        if (targetIndex < 0) {
            currentIndex = totalSlides - 1;
        } else if (targetIndex >= totalSlides) {
            currentIndex = 0;
        } else {
            currentIndex = targetIndex;
        }
        
        const moveDistance = -currentIndex * getCarouselWidth();
        track.style.transform = `translateX(${moveDistance}px)`;
        
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentIndex);
        });
    };
    
    const startAutoSlide = () => {
        if (autoSlideTimer) {
            clearInterval(autoSlideTimer);
        }
        autoSlideTimer = setInterval(() => {
            goToSlide(currentIndex + 1);
        }, 5000);
    };
    
    const stopAutoSlide = () => {
        if (autoSlideTimer) {
            clearInterval(autoSlideTimer);
            autoSlideTimer = null;
        }
    };
    
    const handleResize = () => goToSlide(currentIndex);
    
    window.addEventListener('resize', handleResize);
    
    prev.addEventListener('click', () => goToSlide(currentIndex - 1));
    next.addEventListener('click', () => goToSlide(currentIndex + 1));
    
    dots.forEach((dot, index) => {
        dot.addEventListener('click', () => goToSlide(index));
    });
    
    root.addEventListener('mouseenter', stopAutoSlide);
    root.addEventListener('mouseleave', startAutoSlide);
    
    goToSlide(0);
    startAutoSlide();
})();
</script>

{% endif %}